# Default values for ccr
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

# Global settings
global:
  # Environment name (dev, tst, acc, prd)
  environment: dev

# Image configuration
image:
  # Harbor registry URL
  registry: harbor.yourcompany.com
  # Image repository
  repository: ccr/ccr
  # Image pull policy
  pullPolicy: IfNotPresent
  # Image tag - override this in CI/CD
  tag: "2.0.0"

# Image pull secrets (if Harbor requires authentication)
imagePullSecrets: []
  # - name: harbor-registry-secret

# Flask application configuration
flask:
  # Number of replicas
  replicaCount: 2

  # Container port
  containerPort: 5000

  # Environment variables
  env:
    # Flask environment (production/development)
    flaskEnv: production

    # MongoDB connection
    mongoHost: mongodb-service
    mongoPort: "27017"
    mongoDb: ccr
    mongoCollection: apis

    # Feature flags
    authEnabled: "true"
    ratelimitEnabled: "true"
    authLockoutEnabled: "true"
    backupEnabled: "true"
    backupRetentionDays: "14"

  # Secrets (will be created from external secret manager in production)
  secrets:
    # Flask secret key (base64 encoded)
    secretKey: ""
    # JWT secret key (base64 encoded)
    jwtSecretKey: ""
    # JWT admin key (base64 encoded)
    jwtAdminKey: ""

  # Resource limits and requests
  resources:
    requests:
      memory: "256Mi"
      cpu: "100m"
    limits:
      memory: "512Mi"
      cpu: "500m"

  # Liveness probe configuration
  livenessProbe:
    enabled: true
    httpGet:
      path: /health/live
      port: 5000
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3

  # Readiness probe configuration
  readinessProbe:
    enabled: true
    httpGet:
      path: /health/ready
      port: 5000
    initialDelaySeconds: 10
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 3

  # Node selector
  nodeSelector: {}

  # Tolerations
  tolerations: []

  # Affinity rules
  affinity: {}

  # Security context
  securityContext:
    runAsNonRoot: true
    runAsUser: 1000
    fsGroup: 1000
    allowPrivilegeEscalation: false
    capabilities:
      drop:
        - ALL

# MongoDB configuration
mongodb:
  # Enable/disable MongoDB deployment
  enabled: true

  # MongoDB image
  image:
    registry: docker.io
    repository: mongo
    tag: "latest"
    pullPolicy: IfNotPresent

  # MongoDB resources
  resources:
    requests:
      memory: "256Mi"
      cpu: "100m"
    limits:
      memory: "512Mi"
      cpu: "500m"

  # Persistent storage
  persistence:
    enabled: true
    storageClass: "standard"
    accessMode: ReadWriteOnce
    size: 10Gi

  # MongoDB port
  port: 27017

  # Security context
  securityContext:
    runAsNonRoot: true
    runAsUser: 999
    fsGroup: 999

# Service configuration
service:
  # Service type (ClusterIP, NodePort, LoadBalancer)
  type: ClusterIP
  # Service port
  port: 5000
  # Target port (container port)
  targetPort: 5000
  # NodePort (only if type is NodePort)
  nodePort: 30500
  # Session affinity
  sessionAffinity: ClientIP

# Ingress configuration
ingress:
  enabled: false
  className: "nginx"
  annotations: {}
    # cert-manager.io/cluster-issuer: "letsencrypt-prod"
    # nginx.ingress.kubernetes.io/ssl-redirect: "true"
  hosts:
    - host: ccr.yourcompany.com
      paths:
        - path: /
          pathType: Prefix
  tls: []
    # - secretName: ccr-tls
    #   hosts:
    #     - ccr.yourcompany.com

# Horizontal Pod Autoscaler
autoscaling:
  enabled: true
  minReplicas: 2
  maxReplicas: 5
  targetCPUUtilizationPercentage: 70
  targetMemoryUtilizationPercentage: 80

# Persistent Volume Claims
persistence:
  # Backup storage
  backup:
    enabled: true
    storageClass: "standard"
    accessMode: ReadWriteOnce
    size: 5Gi
    mountPath: /app/backups

  # Logs storage (ephemeral)
  logs:
    enabled: true
    emptyDir: true
    mountPath: /app/logs

# Service Account
serviceAccount:
  # Create service account
  create: true
  # Service account name
  name: ""
  # Annotations
  annotations: {}

# RBAC configuration
rbac:
  # Create RBAC resources
  create: true

# Pod annotations
podAnnotations: {}
  # prometheus.io/scrape: "true"
  # prometheus.io/port: "5000"
  # prometheus.io/path: "/metrics"

# Pod labels
podLabels:
  app.kubernetes.io/component: backend
  app.kubernetes.io/part-of: ccr

# Deployment strategy
strategy:
  type: RollingUpdate
  rollingUpdate:
    maxSurge: 1
    maxUnavailable: 0

# Network Policy
networkPolicy:
  enabled: false
  policyTypes:
    - Ingress
    - Egress
  ingress:
    - from:
      - namespaceSelector:
          matchLabels:
            name: ccr
      ports:
      - protocol: TCP
        port: 5000

# Monitoring
monitoring:
  # Enable Prometheus ServiceMonitor
  serviceMonitor:
    enabled: false
    interval: 30s
    path: /metrics
    labels: {}

# Backup job configuration
backup:
  enabled: false
  schedule: "0 2 * * *"  # Daily at 2 AM
  image:
    registry: docker.io
    repository: bitnami/mongodb
    tag: "latest"
  resources:
    requests:
      memory: "128Mi"
      cpu: "50m"
    limits:
      memory: "256Mi"
      cpu: "200m"

# External secrets (for production)
externalSecrets:
  enabled: false
  backendType: vault  # or azureKeyVault
  vaultPath: "secret/data/ccr/api-manager"
  keys:
    - secretKey
    - jwtSecretKey
    - jwtAdminKey
