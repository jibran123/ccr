<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CCR API Manager</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
    <!-- Add Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1>CCR API Manager</h1>
            <div class="nav-buttons">
                <button class="nav-btn active">Search</button>
                <a href="/health" class="nav-btn">Health</a>
            </div>
        </header>

        <!-- Search Section -->
        <div class="search-section">
            <h2>API Search</h2>
            
            <!-- Search Help & Examples (Collapsible) -->
            <details class="search-help">
                <summary>Search Help & Examples</summary>
                <div class="help-content">
                    <h3>Search Syntax Guide</h3>
                    
                    <div class="help-section">
                        <h4>1. Simple Text Search</h4>
                        <p>Search with word boundaries (case insensitive). Does NOT search inside Properties.</p>
                        <ul>
                            <li><code>blue</code> - Matches "ivp-test-app-blue", "blue-api"</li>
                            <li><code>tst</code> - Matches "tst-api", environment="tst" (NOT "test-api")</li>
                            <li><code>ip4</code> - Matches platform="IP4" (NOT "IP3" or "IP5")</li>
                        </ul>
                        <p class="note">‚úì Word boundary matching - "tst" won't match "test" or "latest"</p>
                        <p class="note">‚úì Always case insensitive</p>
                        <p class="note">‚úì Searches: API Name, Platform, Environment, Status, Version, UpdatedBy</p>
                    </div>
                    
                    <div class="help-section">
                        <h4>2. Attribute Search</h4>
                        <p class="important">‚ö†Ô∏è Always case sensitive for values!</p>
                        <p>Search specific fields using: <code>Attribute = value</code></p>
                        <ul>
                            <li><code>API NAME = ivp-test-app-blue</code> - Exact API name</li>
                            <li><code>Platform = IP4</code> - Only deployments on IP4</li>
                            <li><code>Environment = tst</code> - Only tst environment</li>
                            <li><code>Status = RUNNING</code> - Only running APIs</li>
                            <li><code>Version = 2.3.86</code> - Specific version</li>
                            <li><code>UpdatedBy = Jibran Patel</code> - Updated by specific user</li>
                        </ul>
                        <p class="note">Supported attributes: API NAME, Platform, Environment, Status, Version, UpdatedBy</p>
                    </div>
                    
                    <div class="help-section">
                        <h4>3. Properties Search</h4>
                        <p class="important">‚ö†Ô∏è Always case sensitive for both key and value!</p>
                        <p>Search within Properties: <code>Properties : key = value</code></p>
                        <ul>
                            <li><code>Properties : env = tst</code> - Property env equals "tst"</li>
                            <li><code>Properties : debug.logging = false</code> - Debug logging is "false" (string)</li>
                            <li><code>Properties : mule.env = tst</code> - Nested property</li>
                            <li><code>Properties : api.id = 2568991</code> - API ID</li>
                        </ul>
                        <p class="note">üí° Property keys and values are case sensitive</p>
                        <p class="note">üí° Values are stored as strings: 'true', 'false', not boolean</p>
                    </div>
                    
                    <div class="help-section">
                        <h4>4. Combined Search (AND / OR)</h4>
                        
                        <h5>AND Operator (Strict - Both Must Match):</h5>
                        <ul>
                            <li><code>tst AND Platform = IP4</code><br>
                                Shows ONLY rows where both "tst" exists AND platform is IP4</li>
                            <li><code>Platform = IP4 AND Environment = tst</code><br>
                                Shows ONLY IP4/tst deployments</li>
                            <li><code>blue AND Status = RUNNING</code><br>
                                Shows ONLY running deployments containing "blue"</li>
                        </ul>
                        
                        <h5>OR Operator (Loose - Either Can Match):</h5>
                        <ul>
                            <li><code>tst OR Platform = IP4</code><br>
                                Shows rows matching "tst" OR rows where platform is IP4</li>
                            <li><code>Platform = IP3 OR Platform = IP4</code><br>
                                Shows deployments on either IP3 or IP4</li>
                        </ul>
                        
                        <h5>Complex Examples:</h5>
                        <ul>
                            <li><code>API NAME = ivp-test-app AND Platform = IP3 AND Environment = prd</code><br>
                                Specific API on specific platform/environment</li>
                            <li><code>RUNNING AND Properties : debug.logging = false</code><br>
                                Running APIs with debug logging disabled</li>
                        </ul>
                    </div>
                    
                    <div class="help-section important-notes">
                        <h4>‚ö†Ô∏è Important Notes</h4>
                        <ul>
                            <li><strong>Simple text</strong>: Case insensitive, word boundaries</li>
                            <li><strong>Attributes</strong>: Case sensitive values (IP4 ‚â† ip4)</li>
                            <li><strong>Properties</strong>: Case sensitive keys and values</li>
                            <li>Leave search empty to show all deployments</li>
                            <li>Results show ONLY matching rows (row-level filtering)</li>
                        </ul>
                    </div>
                </div>
            </details>

            <!-- Search Form -->
            <form id="searchForm">
                <div class="search-input-group">
                    <input 
                        type="text" 
                        id="searchInput" 
                        placeholder="Enter search query..." 
                        class="search-input"
                    >
                    <button type="submit" class="search-btn">SEARCH</button>
                    <button type="button" class="clear-btn" id="clearBtn">CLEAR</button>
                </div>
                
                <div class="search-options">
                    <select id="resultsPerPage">
                        <option value="10">10 per page</option>
                        <option value="25">25 per page</option>
                        <option value="50">50 per page</option>
                        <option value="100" selected>100 per page</option>
                        <option value="200">200 per page</option>
                    </select>
                </div>
            </form>

            <!-- Error Container -->
            <div id="errorContainer" class="error-message" style="display: none;"></div>
        </div>

        <!-- Results Section -->
        <div id="resultsContainer" class="results-section">
            <div class="results-header">
                <h3 id="resultCount">
                    <i class="fas fa-chart-bar"></i> Search Results
                </h3>
                <div class="export-buttons">
                    <button id="exportJsonBtn" class="export-btn">
                        <i class="fas fa-download"></i> Export JSON
                    </button>
                    <button id="exportCsvBtn" class="export-btn">
                        <i class="fas fa-file-csv"></i> Export CSV
                    </button>
                </div>
            </div>
            
            <!-- Results Table -->
            <div class="table-container">
                <table class="results-table" id="apiTable">
                    <thead>
                        <tr>
                            <th>API Name</th>
                            <th>Version</th>
                            <th>Platform</th>
                            <th>Environment</th>
                            <th>Deployment Date</th>
                            <th>Last Updated</th>
                            <th>Updated By</th>
                            <th>Status</th>
                            <th>Properties</th>
                        </tr>
                    </thead>
                    <tbody id="apiTableBody">
                        <!-- Results will be populated here by JavaScript -->
                    </tbody>
                </table>
            </div>
            
            <!-- Pagination -->
            <div id="pagination" class="pagination"></div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="{{ url_for('static', filename='js/search.js') }}"></script>
</body>
</html>